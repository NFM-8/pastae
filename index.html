<!DOCTYPE html>
<html lang="en">
<head>
<title>Pastae</title>
<meta charset="utf-8">

<style>
.flex-container {
  display: flex;
  justify-content: center;
}
.box {
  margin-bottom: 35px;
}
.footer {
  padding: 10px;
  text-align: center;
}
.button {
  background-color: #e7e7e7;
  border: none;
  color: black;
  padding: 15px 32px;
  border: 2px solid #ccc;
  border-radius: 4px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
}
.text {
  border: 2px solid #ccc;
  border-radius: 4px;
  background-color: #f8f8f8;
}
textarea {
  width: 100%;
  height: 150px;
  padding: 12px 20px;
  box-sizing: border-box;
  border: 2px solid #ccc;
  border-radius: 4px;
  background-color: #f8f8f8;
}
fieldset {
  border: 2px solid #ccc;
  border-radius: 4px;
}
p.sansserif {
  font-family: Arial, Helvetica, sans-serif;
}
legend.sansserif {
  font-family: Arial, Helvetica, sans-serif;
  font-size: 1.875em;
}
</style>
</head>
<body>

<div class="flex-container">
<div class="box" id="woop"></div>
</div>

<div class="flex-container">

<div class="box">
<form action="/upload" id="paste" method="post" enctype="multipart/form-data">
  <fieldset>
    <legend class="sansserif">Upload paste</legend>
    <textarea form="paste" name="data" autocomplete="off" rows="15" cols="80" required></textarea>
    <input type="hidden" name="content-type" value="text/plain">
    <p class="sansserif">
        <label>
          <input type="checkbox" name="bar" value="bar">
          Burn after reading
        </label>
    </p>
    <p><button class="button">Submit</button></p>
  </fieldset>
</form>
</div>

<div class="box">
<form action="/upload" id="upload" method="post" enctype="multipart/form-data">
    <fieldset>
      <legend class="sansserif">Upload image</legend>
      <input type="file" name="file" class="button" required>
      <p class="sansserif">
          <label>
            <input type="checkbox" name="bar" value="bar">
            Burn after reading
          </label>
      </p>
      <p><button class="button">Submit</button></p>
    </fieldset>
  </form>
</div>

</div>

<div class="flex-container">
  <div class="box" id="login">
    <fieldset>
      <legend class="sansserif">Log in</legend>
      <p class="sansserif">
      <label for="user-login">User name:</label><br>
      <input type="text" name="user-login" id="user-login" class="text" required>
      </p>
      <p class="sansserif">
      <label for="password-login">Password:</label><br>
      <input type="password" name="password-login" id="password-login" class="text" required>
      </p>
      <p><button onclick="logIn()" class="button">Submit</button></p>
    </fieldset>
  </div>
</div>

<div class="flex-container">
  <div class="box" id="register">
  <fieldset>
    <legend class="sansserif">Register</legend>
    <p class="sansserif">
    <label for="user-register">User name:</label><br>
    <input type="text" name="user-register" id="user-register" class="text" required>
    </p>
    <p class="sansserif">
    <label for="password-register">Password:</label><br>
    <input type="password" name="password-register" id="password-register" class="text" required>
    </p>
    <p><button onclick="register()" class="button">Submit</button></p>
  </fieldset>
</div>
</div>

<div class="footer">
    <p class="sansserif">Powered by <a href="https://github.com/NFM-8/pastae">pastae</a></p>
</div>

<script>
  async function logIn() {
    var decoder = new TextDecoder();
    const message1 = document.getElementById("user-login").value;
    const message2 = document.getElementById("password-login").value;
    const hash = await computeHash(message1, message2);

    let response = await fetch('/session/login', {
      method: 'POST',
      body: btoa(String.fromCharCode(...new Uint8Array(hash)))
    });

    if(response.ok) {
      let sessid = await response.text();
      document.getElementById('woop').innerHTML =
        "<p class=\"sansserif\">Logged in as " + message1 + "</p>";
      document.getElementById('login').innerHTML = "";
      document.getElementById('register').innerHTML = "";
    }
  }

  async function register() {
    var decoder = new TextDecoder();
    const message1 = document.getElementById("user-register").value;
    const message2 = document.getElementById("password-register").value;
    const hash = await computeHash(message1, message2);

    let response = await fetch('/session/register', {
      method: 'POST',
      body: btoa(String.fromCharCode(...new Uint8Array(hash)))
    });

    if(response.ok) {
      let result = await response.text();
      document.getElementById('woop').innerHTML =
        "<p class=\"sansserif\">Registered user " + message1 +"</p>";
      document.getElementById('login').innerHTML = "";
    }
  }

  async function computeHash(text1, text2) {
    const encoder = new TextEncoder();
    const t = text1 + "FpF97vqSEMvfTWtMtwg27tGduc667XyCSfJKy4pZhRLmDsyMUsBbqQbbJEBbWyu6" + text2;
    const h1 = await crypto.subtle.digest('SHA-512', encoder.encode(t));
    const h2 = await crypto.subtle.digest('SHA-256', h1);
    return await crypto.subtle.digest('SHA-512', h2);
  }
</script>

</body>
</html>